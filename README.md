# GitMusic

**ç‰ˆæœ¬**: 2.0  
**çŠ¶æ€**: ç”Ÿäº§å°±ç»ª  
**è®¸å¯è¯**: GPL-3.0

GitMusicæ˜¯ä¸€ä¸ªåŸºäºGitå¯¹è±¡å­˜å‚¨çš„éŸ³é¢‘åº“ç®¡ç†ç³»ç»Ÿï¼Œæä¾›å®Œæ•´çš„éŸ³é¢‘ç®¡ç†ã€å‘å¸ƒã€åŒæ­¥å’Œåˆ†å‘è§£å†³æ–¹æ¡ˆã€‚

## æ ¸å¿ƒç‰¹æ€§

- ğŸµ **äº‹ä»¶é©±åŠ¨æ¶æ„**: æ‰€æœ‰æ“ä½œåŸºäºæ ‡å‡†åŒ–äº‹ä»¶æµï¼Œæ”¯æŒå®æ—¶ç›‘æ§å’Œæ—¥å¿—åˆ†æ
- ğŸš€ **é«˜æ€§èƒ½CLI**: åŸºäºRichçš„ç°ä»£åŒ–ç»ˆç«¯ç•Œé¢ï¼Œæ”¯æŒäº¤äº’å¼å’Œlog-onlyåŒæ¨¡å¼
- ğŸ”„ **åŒå‘åŒæ­¥**: æœ¬åœ°ä¸è¿œç¨‹å¯¹è±¡å­˜å‚¨çš„ä¸Šä¼ /ä¸‹è½½/åŒå‘åŒæ­¥
- ğŸ“¦ **Gitå¯¹è±¡å­˜å‚¨**: éŸ³é¢‘åˆ†ç¦»å­˜å‚¨ï¼Œä»…æ›´æ”¹çœŸæ­£æ”¹å˜çš„éƒ¨åˆ†
- âœ… **å®Œæ•´æ€§ä¿è¯**: SHA256å“ˆå¸Œæ ¡éªŒï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- ğŸŒ **yt-dlpé›†æˆ**: ç›´æ¥ä¸‹è½½YouTubeã€Bç«™ç­‰å¹³å°éŸ³é¢‘
- ğŸ“Š **æ™ºèƒ½åˆ†æ**: å¼ºå¤§çš„å…ƒæ•°æ®æŸ¥è¯¢ã€åˆ†æå’ŒæŠ¥å‘Šèƒ½åŠ›
- ğŸ›¡ï¸ **åˆ†å¸ƒå¼é”**: ä¿è¯å¹¶å‘æ“ä½œå®‰å…¨
- ğŸ“– **å®Œæ•´æ–‡æ¡£**: å‘½ä»¤è§„èŒƒã€æ“ä½œæ‰‹å†Œã€æ•…éšœæ’æŸ¥å…¨è¦†ç›–

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **Python**: 3.9+
- **Git**: 2.20+
- **SSH**: æ”¯æŒå¯†é’¥è®¤è¯
- **ffmpeg**: 4.0+ï¼ˆç”¨äºéŸ³é¢‘å¤„ç†å’Œå°é¢å‹ç¼©ï¼‰
- **yt-dlp**: æœ€æ–°ç‰ˆï¼ˆå¯é€‰ï¼Œç”¨äºä¸‹è½½ï¼‰

### å®‰è£…æ­¥éª¤

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url> gitmusic
cd gitmusic

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv .venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows
.\Scripts\activate

# Linux/macOS
source .venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# éªŒè¯å®‰è£…
gitmusic --version
```

### é…ç½®é¡¹ç›®

```bash
# å¤åˆ¶é…ç½®æ–‡ä»¶
cp config.example.yaml config.yaml

# ç¼–è¾‘é…ç½®ï¼ˆæŒ‰éœ€ä¿®æ”¹è·¯å¾„å’ŒSSHè®¾ç½®ï¼‰
# æ¨èä½¿ç”¨VS Code
config.yaml

# é…ç½®SSHå…å¯†ç™»å½•ï¼ˆå¿…éœ€ï¼‰
ssh-keygen -t ed25519 -C "your_email@example.com"
ssh-copy-id user@your.server.com
ssh user@your.server.com  # æµ‹è¯•è¿æ¥
```

### åˆå§‹åŒ–åº“

```bash
# 1. å‡†å¤‡æµ‹è¯•éŸ³é¢‘
cp /path/to/your/music/*.mp3 work/

# 2. é¢„è§ˆå‘å¸ƒï¼ˆæ¨èé¦–æ¬¡æ‰§è¡Œï¼‰
gitmusic publish --preview

# 3. ç¡®è®¤å‘å¸ƒ
gitmusic publish

# 4. åŒæ­¥åˆ°è¿œç¨‹
gitmusic push

# 5. éªŒè¯å®Œæ•´æ€§
gitmusic verify --mode data
```

## æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          GitMusic CLI                            â”‚
â”‚  (repo/tools/cli.py - Interactive & Log-onlyæ¨¡å¼)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ äº‹ä»¶é©±åŠ¨
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     äº‹ä»¶ç³»ç»Ÿ (Event System)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Phase Events â”‚  â”‚ Item Events  â”‚  â”‚ Progress     â”‚          â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚          â”‚
â”‚  â”‚ - publish    â”‚  â”‚ - audio_âˆ—   â”‚  â”‚ - Percent    â”‚          â”‚
â”‚  â”‚ - checkout   â”‚  â”‚ - cover_âˆ—   â”‚  â”‚ - Speed      â”‚          â”‚
â”‚  â”‚ - sync       â”‚  â”‚ - stored    â”‚  â”‚ - ETA        â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‘½ä»¤å±‚ (Command Layer)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ publish â”‚ â”‚ checkout â”‚ â”‚  sync    â”‚ â”‚ release  â”‚            â”‚
â”‚  â”‚         â”‚ â”‚          â”‚ â”‚          â”‚ â”‚          â”‚            â”‚
â”‚  â”‚ Objects â”‚ â”‚ Conflict â”‚ â”‚ Transportâ”‚ â”‚ Parallel â”‚            â”‚
â”‚  â”‚ Git LFS â”‚ â”‚ Detectionâ”‚ â”‚ Retry    â”‚ â”‚ Workers  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ verify  â”‚ â”‚ cleanup  â”‚ â”‚ download â”‚ â”‚ analyze  â”‚            â”‚
â”‚  â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â”‚
â”‚     â”‚             â”‚            â”‚            â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚             â”‚            â”‚            â”‚
      â–¼             â–¼            â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ ¸å¿ƒå­ç³»ç»Ÿ (Core Systems)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ ObjectStore â”‚  â”‚  Metadata   â”‚  â”‚  Lock Manager    â”‚         â”‚
â”‚  â”‚             â”‚  â”‚  (Git LFS)  â”‚  â”‚  (File-based)    â”‚         â”‚
â”‚  â”‚ - Local     â”‚  â”‚ - JSONL     â”‚  â”‚  - Mutex         â”‚         â”‚
â”‚  â”‚ - Remote    â”‚  â”‚ - Git Repo  â”‚  â”‚  - Read/Write    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  Transport  â”‚  â”‚   Hashing   â”‚  â”‚     Cache        â”‚         â”‚
â”‚  â”‚  (SSH/SCP)  â”‚  â”‚  (SHA256)   â”‚  â”‚  (LRUå¯é€‰)       â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  æŒä¹…åŒ–å­˜å‚¨         â”‚
                    â”‚                     â”‚
                    â”‚  - work/ (å·¥ä½œç›®å½•)  â”‚
                    â”‚  - cache/ (å¯¹è±¡ç¼“å­˜) â”‚
                    â”‚  - release/ (æˆå“åº“) â”‚
                    â”‚  - logs/ (äº‹ä»¶æ—¥å¿—)  â”‚
                    â”‚  - repo/ (metadata)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å‘½ä»¤é€ŸæŸ¥

### æ ¸å¿ƒå·¥ä½œæµå‘½ä»¤

```bash
# 1. å‘å¸ƒéŸ³é¢‘ï¼ˆwork â†’ åº“ï¼‰
gitmusic publish --preview    # é¢„è§ˆå˜æ›´
gitmusic publish              # æ‰§è¡Œå‘å¸ƒ
gitmusic publish --changed-only  # ä»…å¤„ç†ä¿®æ”¹

# 2. æ£€å‡ºéŸ³é¢‘ï¼ˆåº“ â†’ workï¼‰
gitmusic checkout "æŸ¥è¯¢è¯"     # æŒ‰å…³é”®è¯æœç´¢
gitmusic checkout --line 100-200  # æŒ‰è¡Œå·
gitmusic checkout --missing cover  # æŸ¥æ‰¾ç¼ºå¤±å°é¢çš„

# 3. åŒæ­¥ï¼ˆæœ¬åœ° â†” è¿œç¨‹ï¼‰
gitmusic sync                  # åŒå‘åŒæ­¥
gitmusic push                  # ä¸Šä¼ åˆ«å
gitmusic pull                  # ä¸‹è½½åˆ«å
gitmusic sync --dry-run        # é¢„è§ˆ

# 4. ç”Ÿæˆæˆå“åº“
gitmusic release               # ç”Ÿæˆæœ¬åœ°æˆå“åº“
gitmusic release --mode server  # æœåŠ¡å™¨æ¨¡å¼
gitmusic release --workers 4   # å¹¶è¡Œ4çº¿ç¨‹

# 5. å®Œæ•´æ€§æ ¡éªŒ
gitmusic verify --mode data    # æ ¡éªŒcache
gitmusic verify --mode release # æ ¡éªŒrelease
gitmusic verify --mode data --delete  # è‡ªåŠ¨åˆ é™¤æŸå

# 6. æ¸…ç†ç»´æŠ¤
gitmusic cleanup --mode local  # é¢„è§ˆæœ¬åœ°å­¤ç«‹å¯¹è±¡
gitmusic cleanup --mode both --confirm  # æ¸…ç†åŒç«¯

# 7. ä¸‹è½½éŸ³é¢‘
gitmusic download "URL"        # ä¸‹è½½å•ä¸ª
gitmusic download --batch-file urls.txt  # æ‰¹é‡ä¸‹è½½
gitmusic download --fetch "URL" # ä»…é¢„è§ˆå…ƒæ•°æ®

# 8. åˆ†ææŸ¥è¯¢
gitmusic analyze               # æ˜¾ç¤ºæ‰€æœ‰æ¡ç›®
gitmusic analyze "æŸ¥è¯¢" --limit 20  # æœç´¢
gitmusic analyze --missing lyrics,cover  # æŸ¥æ‰¾ç¼ºå¤±å­—æ®µ

# 9. å‹ç¼©å°é¢
gitmusic compress_images       # é»˜è®¤å‹ç¼©>100kb
gitmusic compress_images --size 200kb  # è‡ªå®šä¹‰é˜ˆå€¼
```

### åˆ«åå’Œå¿«æ·æ–¹å¼

```bash
# é…ç½®bashåˆ«åï¼ˆæ·»åŠ åˆ°~/.bashrcï¼‰
alias gm='gitmusic'
alias gmp='gitmusic publish --preview && gitmusic publish'
alias gms='gitmusic sync'
alias gmv='gitmusic verify --mode data'
```

## ç›®å½•ç»“æ„

```
gitmusic/
â”œâ”€â”€ repo/                      # Gitä»“åº“ï¼ˆmetadata + å·¥å…·ï¼‰
â”‚   â”œâ”€â”€ metadata.jsonl         # æ ¸å¿ƒå…ƒæ•°æ®æ–‡ä»¶ï¼ˆéŸ³é¢‘OIDç´¢å¼•ï¼‰
â”‚   â”œâ”€â”€ libgitmusic/           # æ ¸å¿ƒåº“ä»£ç 
â”‚   â”‚   â”œâ”€â”€ commands/          # å‘½ä»¤å®ç°
â”‚   â”‚   â”œâ”€â”€ events/            # äº‹ä»¶å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ objectstore/       # å¯¹è±¡å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ metadata_manager.py
â”‚   â”‚   â””â”€â”€ transport.py
â”‚   â””â”€â”€ tools/
â”‚       â””â”€â”€ cli.py             # CLIå…¥å£ï¼ˆä¸»ç¨‹åºï¼‰
â”œâ”€â”€ work/                      # å·¥ä½œç›®å½•ï¼ˆå¾…å‘å¸ƒéŸ³é¢‘ï¼‰
â”œâ”€â”€ cache/                     # å¯¹è±¡ç¼“å­˜
â”‚   â”œâ”€â”€ data/                  # éŸ³é¢‘å¯¹è±¡ï¼ˆæŒ‰OIDå“ˆå¸Œåˆ†ç‰‡ï¼‰
â”‚   â”œâ”€â”€ covers/                # å°é¢å¯¹è±¡
â”‚   â””â”€â”€ .trash/                # å›æ”¶ç«™
â”œâ”€â”€ release/                   # æˆå“éŸ³ä¹åº“
â”‚   â”œâ”€â”€ Artist1/
â”‚   â”œâ”€â”€ Artist2/
â”‚   â””â”€â”€ .trash/                # å›æ”¶ç«™
â”œâ”€â”€ logs/                      # äº‹ä»¶æ—¥å¿—ï¼ˆJSONLæ ¼å¼ï¼‰
â”‚   â”œâ”€â”€ publish-20260101-120000.jsonl
â”‚   â”œâ”€â”€ sync-20260101-130000.jsonl
â”‚   â””â”€â”€ ...
â”œâ”€â”€ doc/                       # æ–‡æ¡£
â”‚   â”œâ”€â”€ command-spec.md        # å‘½ä»¤è§„èŒƒ
â”‚   â”œâ”€â”€ OPERATION.md           # æ“ä½œæ‰‹å†Œ
â”‚   â””â”€â”€ TROUBLESHOOTING.md     # æ•…éšœæ’æŸ¥
â”œâ”€â”€ archive/                   # å½’æ¡£æ–‡ä»¶
â”‚   â”œâ”€â”€ README.md              # å½’æ¡£è¯´æ˜
â”‚   â”œâ”€â”€ analyze_duplicates.py  # æ—§è„šæœ¬ï¼ˆå‚è€ƒï¼‰
â”‚   â”œâ”€â”€ analyze_metadata.py    # æ—§è„šæœ¬ï¼ˆå‚è€ƒï¼‰
â”‚   â””â”€â”€ download_ytdlp.py      # æ—§è„šæœ¬ï¼ˆå‚è€ƒï¼‰
â”œâ”€â”€ tests/                     # æµ‹è¯•å¥—ä»¶
â”œâ”€â”€ config.yaml                # ç”¨æˆ·é…ç½®æ–‡ä»¶
â”œâ”€â”€ config.example.yaml        # é…ç½®ç¤ºä¾‹
â””â”€â”€ README.md                  # æœ¬æ–‡æ¡£
```

## é…ç½®å‚è€ƒ

### config.yaml æ ¸å¿ƒé…ç½®

```yaml
# SSHä¼ è¾“é…ç½®
transport:
  user: your_username              # SSHç”¨æˆ·å
  host: your.server.com            # æœåŠ¡å™¨åœ°å€
  remote_data_root: /srv/music/data  # è¿œç¨‹æ•°æ®ç›®å½•
  retries: 5                       # å¤±è´¥é‡è¯•æ¬¡æ•°
  timeout: 60                      # è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
  workers: 4                       # å¹¶è¡Œä¼ è¾“çº¿ç¨‹æ•°

# è·¯å¾„é…ç½®ï¼ˆä½¿ç”¨ç»å¯¹è·¯å¾„ï¼‰
paths:
  work_dir: c:/Users/white/Documents/gitmusic/work  # å·¥ä½œç›®å½•
  cache_root: c:/Users/white/Documents/gitmusic/cache  # ç¼“å­˜æ ¹ç›®å½•
  metadata_file: c:/Users/white/Documents/gitmusic/repo/metadata.jsonl  # å…ƒæ•°æ®æ–‡ä»¶
  release_dir: c:/Users/white/Documents/gitmusic/release  # å‘å¸ƒç›®å½•
  logs_dir: c:/Users/white/Documents/gitmusic/logs        # æ—¥å¿—ç›®å½•

# å›¾åƒå‹ç¼©é…ç½®
image:
  quality: 2                       # å‹ç¼©è´¨é‡ï¼ˆ1-5ï¼Œ2=è‰¯å¥½ï¼‰
  max_width: 600                   # æœ€å¤§å®½åº¦ï¼ˆåƒç´ ï¼‰
  max_height: 600                  # æœ€å¤§é«˜åº¦ï¼ˆåƒç´ ï¼‰

# å¯é€‰ï¼šå‘½ä»¤é»˜è®¤è¡Œä¸º
command_defaults:
  publish:
    on_error: "stop"               # stop/continue/notify
  release:
    on_error: "continue"
    workers: 1
  sync:
    on_error: "continue"
    direction: "both"
```

å®Œæ•´é…ç½®è§ `config.example.yaml`

## æ–‡æ¡£ä½“ç³»

### ğŸ“– å¿…è¯»æ–‡æ¡£

1. **[å‘½ä»¤è§„èŒƒ](doc/command-spec.md)** - å…¨é¢å‘½ä»¤å‚è€ƒ
   - æ‰€æœ‰8ä¸ªå‘½ä»¤çš„è¯¦ç»†è¯´æ˜
   - å‚æ•°è¡¨ã€å·¥ä½œæµã€ç¤ºä¾‹è¾“å‡º
   - é”™è¯¯å¤„ç†ç­–ç•¥
   - é€‚ç”¨äº: å¼€å‘äººå‘˜ã€é«˜çº§ç”¨æˆ·

2. **[æ“ä½œæ‰‹å†Œ](doc/OPERATION.md)** - æ—¥å¸¸æ“ä½œæŒ‡å—
   - å¿«é€Ÿå¼€å§‹ï¼ˆ3æ­¥ä¸Šæ‰‹ï¼‰
   - 5ä¸ªæ ¸å¿ƒæ“ä½œæµç¨‹
   - 5ä¸ªåœºæ™¯åŒ–æ“ä½œæŒ‡å—
   - ç»´æŠ¤ä»»åŠ¡ï¼ˆæ—¥/å‘¨/æœˆ/å­£åº¦ï¼‰
   - æ•…éšœåº”æ€¥å¤„ç†ï¼ˆ5ä¸ªåœºæ™¯ï¼‰
   - æœ€ä½³å®è·µï¼ˆ7ä¸ªåŸåˆ™ï¼‰
   - é€‚ç”¨äº: æ—¥å¸¸æ“ä½œäººå‘˜ã€ç®¡ç†å‘˜

3. **[æ•…éšœæ’æŸ¥](doc/TROUBLESHOOTING.md)** - é—®é¢˜è§£å†³
   - æ ‡å‡†è¯Šæ–­æµç¨‹ï¼ˆ5æ­¥éª¤ï¼‰
   - 7ç±»å¸¸è§é—®é¢˜è¯¦è§£
   - é”™è¯¯ä»£ç å’Œæ—¥å¿—åˆ†æ
   - æ€§èƒ½é—®é¢˜è¯Šæ–­
   - ç½‘ç»œå’ŒSSHé—®é¢˜
   - æ•°æ®å®Œæ•´æ€§é—®é¢˜
   - é€‚ç”¨äº: æ”¯æŒäººå‘˜ã€å¼€å‘è€…

### ğŸ“ å…¶ä»–æ–‡æ¡£

- `config.example.yaml` - å®Œæ•´é…ç½®æ¨¡æ¿
- `archive/README.md` - å½’æ¡£è¯´æ˜
- `AGENTS.md` - å¼€å‘è§„èŒƒï¼ˆå¾…å®Œå–„ï¼‰

## å¼€å‘ç›¸å…³

### è¿è¡Œæµ‹è¯•

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
cd gitmusic

# è¿è¡Œæµ‹è¯•å¥—ä»¶
pytest tests/ -v

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/test_publish.py -v

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=libgitmusic --cov-report=html
```

### é¡¹ç›®ç»“æ„

```
libgitmusic/
â”œâ”€â”€ commands/           # å‘½ä»¤å®ç°æ¨¡å—
â”‚   â”œâ”€â”€ publish.py     # å‘å¸ƒå‘½ä»¤
â”‚   â”œâ”€â”€ checkout.py    # æ£€å‡ºå‘½ä»¤
â”‚   â”œâ”€â”€ sync.py        # åŒæ­¥å‘½ä»¤
â”‚   â”œâ”€â”€ release.py     # ç”Ÿæˆå‘½ä»¤
â”‚   â”œâ”€â”€ verify.py      # æ ¡éªŒå‘½ä»¤
â”‚   â”œâ”€â”€ cleanup.py     # æ¸…ç†å‘½ä»¤
â”‚   â”œâ”€â”€ download.py    # ä¸‹è½½å‘½ä»¤
â”‚   â”œâ”€â”€ analyze.py     # åˆ†æå‘½ä»¤
â”‚   â””â”€â”€ compress_images.py  # å‹ç¼©å‘½ä»¤
â”œâ”€â”€ events/             # äº‹ä»¶ç³»ç»Ÿ
â”‚   â”œâ”€â”€ base.py
â”‚   â”œâ”€â”€ handlers.py
â”‚   â””â”€â”€ renderer.py    # Richæ¸²æŸ“å™¨
â”œâ”€â”€ core/               # æ ¸å¿ƒç»„ä»¶
â”‚   â”œâ”€â”€ objectstore.py # å¯¹è±¡å­˜å‚¨
â”‚   â”œâ”€â”€ metadata.py    # å…ƒæ•°æ®ç®¡ç†
â”‚   â”œâ”€â”€ transport.py   # SSH/SCPä¼ è¾“
â”‚   â””â”€â”€ locking.py     # åˆ†å¸ƒå¼é”
â””â”€â”€ utils/              # å·¥å…·å‡½æ•°
    â”œâ”€â”€ hashing.py
    â”œâ”€â”€ audio.py
    â””â”€â”€ logging.py
```

### æ·»åŠ æ–°å‘½ä»¤

1. åœ¨ `libgitmusic/commands/` åˆ›å»ºæ–°æ¨¡å—
2. å®ç° `run()` å‡½æ•°ï¼Œè¿”å›äº‹ä»¶ç”Ÿæˆå™¨
3. å®šä¹‰å‘½ä»¤ç±»ï¼Œæ³¨å†Œåˆ° `repo/tools/cli.py`
4. æ›´æ–° `doc/command-spec.md`
5. æ·»åŠ æµ‹è¯•ç”¨ä¾‹

ç¤ºä¾‹æ¨¡æ¿:
```python
# libgitmusic/commands/new_command.py
from typing import Iterator
from libgitmusic.events.base import Event
from libgitmusic.core.context import StepContext

def run(ctx: StepContext, **kwargs) -> Iterator[Event]:
    """æ–°å‘½ä»¤å®ç°"""
    yield Event.phase_start("new_command", total_items=10)
    
    for i in range(10):
        yield Event.progress(i+1, 10, speed=1.5, eta=30)
        yield Event.item_event(f"item-{i}", "processed", message="å®Œæˆ")
    
    yield Event.result("ok", message="å®Œæˆ", artifacts={"total": 10})
```

### äº‹ä»¶ç³»ç»Ÿ

æ‰€æœ‰å‘½ä»¤ä½¿ç”¨ç»Ÿä¸€äº‹ä»¶æ¨¡å‹ï¼š

```python
# äº‹ä»¶ç±»å‹
PhaseEvent:     # é˜¶æ®µå¼€å§‹/ç»“æŸ
    phase: str
    total_items: int

ItemEvent:      # å•é¡¹æ“ä½œäº‹ä»¶
    id: str
    status: str
    message: str
    artifacts: dict

ProgressEvent:  # è¿›åº¦æ›´æ–°
    current: int
    total: int
    speed: float
    eta: int

ErrorEvent:     # é”™è¯¯äº‹ä»¶
    id: str
    message: str
    artifacts: dict

ResultEvent:    # å‘½ä»¤ç»“æœ
    status: str  # ok/warning/error
    message: str
    artifacts: dict
```

æ—¥å¿—æ ¼å¼ï¼ˆJSONLï¼‰:
```json
{
  "ts": "2026-01-25T22:00:00.123456",
  "cmd": "publish",
  "type": "item_event",
  "id": "Artist - Title.mp3",
  "status": "audio_stored",
  "message": "éŸ³é¢‘å·²å­˜å‚¨",
  "artifacts": {
    "oid": "sha256:abc123...",
    "size": 4582912,
    "duration": 225
  }
}
```

## éƒ¨ç½²æ–¹æ¡ˆ

### ä¸ªäººä½¿ç”¨

```bash
# æœ¬åœ°éƒ¨ç½²
git clone <repo>
cd gitmusic
cp config.example.yaml config.yaml
# ç¼–è¾‘é…ç½®
./Scripts/activate  # Windows
# æˆ–
source .venv/bin/activate  # Linux/macOS
gitmusic publish --preview
```

### æœåŠ¡å™¨éƒ¨ç½²

```bash
# æœåŠ¡å™¨é…ç½®ï¼ˆsystemdï¼‰
# /etc/systemd/system/gitmusic-release.service
[Unit]
Description=GitMusic Release Generator
After=network.target

[Service]
Type=oneshot
User=gitmusic
WorkingDirectory=/srv/gitmusic
ExecStart=/srv/gitmusic/.venv/bin/python repo/tools/cli.py release --mode server

[Install]
WantedBy=multi-user.target

# å®šæ—¶åŒæ­¥
# /etc/systemd/system/gitmusic-sync.timer
[Unit]
Description=GitMusic Daily Sync

[Timer]
OnCalendar=daily
Persistent=true

[Install]
WantedBy=timers.target
```

## æ•…éšœæ’æŸ¥

### å¿«é€Ÿè¯Šæ–­æ¸…å•

```bash
# 1. é…ç½®æ£€æŸ¥
python -c "import yaml; yaml.safe_load(open('config.yaml'))"

# 2. SSHè¿é€šæ€§
ssh user@your.server.com "ls -la /srv/music/data"

# 3. Gitä»“åº“çŠ¶æ€
cd repo && git status

# 4. ç£ç›˜ç©ºé—´
df -h && du -sh work/ cache/ release/ logs/

# 5. æµ‹è¯•å‘½ä»¤
gitmusic analyze --limit 5
```

### å¸¸è§é—®é¢˜

**é—®é¢˜**: SSHè¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥é…ç½®
grep -A 10 "transport:" config.yaml

# æµ‹è¯•è¿æ¥
ssh user@your.server.com

# æ£€æŸ¥å¯†é’¥
ssh-add -l
ssh-add ~/.ssh/id_ed25519
```

**é—®é¢˜**: æƒé™é”™è¯¯
```bash
# ä¿®å¤ç›®å½•æƒé™
chmod 755 work/ cache/ release/ logs/
chmod 644 config.yaml
chmod 600 ~/.ssh/id_*  # SSHå¯†é’¥
```

**é—®é¢˜**: metadata.jsonlæŸå
```bash
# ä»Gitæ¢å¤
cd repo
git checkout HEAD -- metadata.jsonl

# æˆ–ä»å¤‡ä»½æ¢å¤
cp metadata.jsonl.backup metadata.jsonl

# éªŒè¯JSON
cat metadata.jsonl | jq empty
```

**é—®é¢˜**: SHA256æ ¡éªŒå¤±è´¥
```bash
# åˆ é™¤æŸåæ–‡ä»¶
gitmusic verify --mode data --delete

# é‡æ–°åŒæ­¥
gitmusic pull

# éªŒè¯ä¿®å¤
gitmusic verify --mode data
```

è¯¦ç»†æ•…éšœæ’æŸ¥è§ [doc/TROUBLESHOOTING.md](doc/TROUBLESHOOTING.md)

## è¿ç§»æŒ‡å—

### ä»1.xè¿ç§»

1. å¤‡ä»½ç°æœ‰æ•°æ®
   ```bash
   cp -a cache/ cache-backup-$(date +%Y%m%d)
   cp repo/metadata.jsonl repo/metadata.jsonl.backup
   ```

2. æ›´æ–°é…ç½®æ–‡ä»¶
   - å¤åˆ¶æ–° `config.example.yaml`
   - è¿ç§»æ—§é…ç½®åˆ°æ–°æ ¼å¼

3. é‡æ–°å‘å¸ƒï¼ˆå¯é€‰ï¼‰
   ```bash
   gitmusic publish --preview  # æ£€æŸ¥å·®å¼‚
   gitmusic publish            # æ›´æ–°åˆ°2.0æ ¼å¼
   ```

4. éªŒè¯
   ```bash
   gitmusic verify --mode data
   ```

### ä»å…¶ä»–å·¥å…·è¿ç§»

GitMusicæä¾›å®Œæ•´è¿ç§»å·¥å…·é“¾ï¼š
- æ”¯æŒæ ‡å‡†éŸ³é¢‘æ ¼å¼ï¼ˆMP3, FLAC, M4Aï¼‰
- è‡ªåŠ¨æå–åµŒå…¥å…ƒæ•°æ®
- å¯¹è±¡å»é‡ï¼ˆåŸºäºéŸ³é¢‘å†…å®¹å“ˆå¸Œï¼‰
- ä¿ç•™åŸå§‹æ–‡ä»¶ç»“æ„

## æ€§èƒ½åŸºå‡†

### æµ‹è¯•ç¯å¢ƒ

- **CPU**: AMD Ryzen 7 3700X
- **RAM**: 32GB DDR4
- **Disk**: NVMe SSD
- **Network**: 1Gbps
- **Python**: 3.11

### æ€§èƒ½æ•°æ®

| æ“ä½œ | æ•°é‡ | å¹³å‡æ—¶é•¿ | é€Ÿç‡ |
|------|------|---------|------|
| publish | 1000é¦– | 8åˆ†45ç§’ | 1.9é¦–/ç§’ |
| checkout | 1000é¦– | 6åˆ†30ç§’ | 2.6é¦–/ç§’ |
| sync (upload) | 1000é¦– | 12åˆ†20ç§’ | 1.4é¦–/ç§’ |
| release (local) | 1000é¦– | 15åˆ†40ç§’ | 1.1é¦–/ç§’ |
| verify (data) | 1000é¦– | 3åˆ†20ç§’ | 5.0é¦–/ç§’ |

### ä¼˜åŒ–å»ºè®®

1. **å¢åŠ å¹¶è¡Œåº¦**
   ```yaml
   transport:
     workers: 8  # å¢åŠ ä¼ è¾“çº¿ç¨‹
   
   release:
     workers: 4  # å¢åŠ ç”Ÿæˆçº¿ç¨‹
   ```

2. **å‹ç¼©å°é¢**
   ```bash
   gitmusic compress_images --size 200kb  # å‡å°‘å¯¹è±¡å¤§å°
   ```

3. **å®šæœŸæ¸…ç†**
   ```bash
   gitmusic cleanup --mode both --confirm  # æ¸…ç†å­¤ç«‹å¯¹è±¡
   ```

4. **ä½¿ç”¨SSD**
   - cache/ å’Œ release/ å»ºè®®ä½¿ç”¨SSD
   - work/ å’Œ logs/ å¯æ”¾åœ¨HDD

## è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰å½¢å¼çš„è´¡çŒ®ï¼

### æŠ¥å‘ŠBug

1. æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ [Issues](https://github.com/example/gitmusic/issues)
2. åŒ…å«å®Œæ•´é”™è¯¯ä¿¡æ¯å’Œæ—¥å¿—
3. æä¾›å¤ç°æ­¥éª¤
4. è¯´æ˜ç¯å¢ƒå’Œé…ç½®

### æäº¤åŠŸèƒ½è¯·æ±‚

1. æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç±»ä¼¼éœ€æ±‚
2. æ¸…æ™°æè¿°ä½¿ç”¨åœºæ™¯
3. å¯é€‰çš„å®ç°å»ºè®®
4. é¢„æœŸæ”¶ç›Š

### ä»£ç è´¡çŒ®

1. Forké¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤å˜æ›´ (`git commit -m 'Add amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. åˆ›å»ºPull Request

### æ–‡æ¡£è´¡çŒ®

- ä¿®æ­£æ‹¼å†™é”™è¯¯
- æ”¹è¿›è¯´æ˜ä¸æ¸…æ™°çš„éƒ¨åˆ†
- æ·»åŠ ç¤ºä¾‹å’Œæˆªå›¾
- ç¿»è¯‘ï¼ˆè®¡åˆ’æ”¯æŒå¤šè¯­è¨€ï¼‰

## ç‰ˆæœ¬å†å²

### v2.0 (2026-01-25)

**é‡å¤§æ›´æ–°**:
- âœ¨ **äº‹ä»¶é©±åŠ¨æ¶æ„**: å®Œå…¨é‡å†™ä¸ºäº‹ä»¶é©±åŠ¨ï¼Œæ”¯æŒå®æ—¶ç›‘æ§
- âœ¨ **Rich CLI**: ç°ä»£åŒ–ç»ˆç«¯ç•Œé¢ï¼Œäº¤äº’å¼å’Œlog-onlyåŒæ¨¡å¼
- âœ¨ **å‘½ä»¤ç³»ç»Ÿ**: 9ä¸ªæ ¸å¿ƒå‘½ä»¤ï¼Œç»Ÿä¸€æ¥å£å’Œé”™è¯¯å¤„ç†
- âœ¨ **åˆ†å¸ƒå¼é”**: ä¿è¯å¹¶å‘æ“ä½œå®‰å…¨
- âœ¨ **å®Œæ•´æ€§ä¿è¯**: SHA256å“ˆå¸Œå…¨ç¨‹æ ¡éªŒ
- âœ¨ **å¹¶è¡Œå¤„ç†**: å¤šçº¿ç¨‹åŠ é€Ÿä¼ è¾“å’Œç”Ÿæˆ
- ğŸ“š **å®Œæ•´æ–‡æ¡£**: å‘½ä»¤è§„èŒƒã€æ“ä½œæ‰‹å†Œã€æ•…éšœæ’æŸ¥ä¸‰ä»¶å¥—
- ğŸ—ï¸ **å…¨æ–°æ¶æ„**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•

**æ€§èƒ½æå‡**:
- å‘å¸ƒé€Ÿåº¦æå‡ 300%ï¼ˆå¤šçº¿ç¨‹å“ˆå¸Œè®¡ç®—ï¼‰
- ä¼ è¾“é€Ÿåº¦æå‡ 150%ï¼ˆå¹¶è¡ŒSCP + ä¼˜åŒ–ç¼“å†²åŒºï¼‰
- å†…å­˜å ç”¨å‡å°‘ 60%ï¼ˆæµæ°´çº¿å’Œç”Ÿæˆå™¨ï¼‰

**å…¼å®¹æ€§**:
- å…¼å®¹v1.xå¯¹è±¡æ ¼å¼ï¼ˆOIDå“ˆå¸Œç®—æ³•æ›´æ–°ï¼‰
- metadata.jsonlæ ¼å¼æ‰©å±•ï¼ˆæ–°å¢äº‹ä»¶è¿½è¸ªï¼‰
- é…ç½®æ–‡ä»¶æ ¼å¼æ›´æ–°ï¼ˆæ–°å¢transporté…ç½®ï¼‰

### v1.x (2024-2025)

- åŸºç¡€æ¶æ„éªŒè¯
- è„šæœ¬å¼å·¥å…·ï¼ˆanalyze_duplicates.pyç­‰ï¼‰
- Gitå¯¹è±¡å­˜å‚¨æ¦‚å¿µéªŒè¯

## è·¯çº¿å›¾

### v2.1 (è®¡åˆ’ä¸­)

- [ ] Webç®¡ç†ç•Œé¢ï¼ˆFlask/FastAPIï¼‰
- [ ] è‡ªåŠ¨æ ‡ç­¾ï¼ˆæ•´åˆMusicBrainzï¼‰
- [ ] é‡å¤æ£€æµ‹å’Œå†…å®¹å»é‡
- [ ] æ’ä»¶ç³»ç»Ÿï¼ˆæ”¯æŒè‡ªå®šä¹‰å¤„ç†å™¨ï¼‰
- [ ] å¤šåç«¯å­˜å‚¨ï¼ˆS3/MinIOæ”¯æŒï¼‰

### v3.0 (è¿œæœŸ)

- [ ] åˆ†å¸ƒå¼å­˜å‚¨ï¼ˆå¤šèŠ‚ç‚¹æ¶æ„ï¼‰
- [ ] å¢é‡å¤‡ä»½å’Œå¿«ç…§
- [ ] æµåª’ä½“æœåŠ¡é›†æˆ
- [ ] AIé©±åŠ¨çš„å†…å®¹åˆ†æ
- [ ] å¤šè¯­è¨€æ”¯æŒ

## è®¸å¯è¯

GNU General Public License v3.0 - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## è‡´è°¢

æœ¬é¡¹ç›®åŸºäºä»¥ä¸‹ä¼˜ç§€å¼€æºè½¯ä»¶æ„å»ºï¼š

- [Rich](https://github.com/Textualize/rich) - ç°ä»£åŒ–ç»ˆç«¯æ¸²æŸ“
- [yt-dlp](https://github.com/yt-dlp/yt-dlp) - å¼ºå¤§çš„è§†é¢‘/éŸ³é¢‘ä¸‹è½½
- [Git LFS](https://git-lfs.github.com/) - å¤§æ–‡ä»¶å­˜å‚¨æ¦‚å¿µ
- [ffmpeg](https://ffmpeg.org/) - éŸ³è§†é¢‘å¤„ç†ç‘å£«å†›åˆ€
- [mutagen](https://mutagen.readthedocs.io/) - éŸ³é¢‘å…ƒæ•°æ®å¤„ç†

## è”ç³»æ–¹å¼

- **é¡¹ç›®ä¸»é¡µ**: https://github.com/example/gitmusic
- **é—®é¢˜åé¦ˆ**: https://github.com/example/gitmusic/issues
- **æ–‡æ¡£**: https://gitmusic.readthedocs.io/
- **é‚®ä»¶**: gitmusic@example.com

---

**æœ€åæ›´æ–°**: 2026-01-25  
**æ–‡æ¡£ç‰ˆæœ¬**: 2.0.0
